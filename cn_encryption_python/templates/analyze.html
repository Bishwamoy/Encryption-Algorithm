
{% extends "base.html" %}
{% block content %}
<h2 class="title">Analysis • {{ scenario.upper() }}</h2>
<p class="subtitle">Input: {{ msg_len }} bytes • Repeat: {{ repeat }} • Source: {{ src_label }}</p>

<div class="grid lg:grid-cols-2 gap-6">
  <div class="panel">
    <div class="panel-title">Algorithms</div>
    <div class="overflow-x-auto">
      <table class="tbl">
        <thead><tr><th>Algorithm</th><th class="t-right">AEAD</th><th class="t-right">Mean (ms)</th><th class="t-right">p95 (ms)</th></tr></thead>
        <tbody>
        {% for r in rows %}
          <tr>
            <td>{{ r.algo }} {{ r.variant }}</td>
            <td class="t-right">{{ "Yes" if r.aead else "No" }}</td>
            <td class="t-right">{{ "%.4f"|format(r.mean_ms) }}</td>
            <td class="t-right">{{ "%.4f"|format(r.p95_ms) }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="panel">
    <div class="panel-title">Performance chart</div>
    <canvas id="chart" height="180"></canvas>
  </div>
</div>

<div class="panel mt-6">
  <div class="panel-title">Ciphertext previews (Base64)</div>
  <div class="grid md:grid-cols-2 gap-3">
    {% for r in rows %}
    <div class="card">
      <div class="flex items-center justify-between mb-1">
        <div class="font-medium">{{ r.algo }} {{ r.variant }}</div>
        <span class="badge">{{ "AEAD" if r.aead else "Enc+MAC" }}</span>
      </div>
      <div class="mono small break-all">{{ r.preview }}</div>
    </div>
    {% endfor %}
  </div>
</div>

<a href="{{ url_for('index') }}" class="btn-secondary mt-6">← Back</a>

<script>
const rows = {{ rows|tojson }};
const labels = rows.map(r => r.algo + " " + r.variant);
const mean = rows.map(r => r.mean_ms);
const p95  = rows.map(r => r.p95_ms);
const ctx = document.getElementById('chart').getContext('2d');
new Chart(ctx, {
  type: 'bar',
  data: {
    labels: labels,
    datasets: [
      {label: 'Mean (ms)', data: mean},
      {label: 'p95 (ms)', data: p95}
    ]
  },
  options: {responsive: true, plugins:{legend:{labels:{color:'#cbd5e1'}}},
            scales:{x:{ticks:{color:'#cbd5e1'}}, y:{ticks:{color:'#94a3b8'}}}}
});
</script>
{% endblock %}
